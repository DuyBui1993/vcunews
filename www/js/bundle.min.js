angular.module("vcuApp",["ionic","angularMoment","ngCordova"]).run(["$ionicPlatform","amMoment",function(e,t){t.changeLocale("vi"),e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,o){e.state("home",{url:"/",templateUrl:"home.template.html",controller:"HomeController"}).state("articles",{url:"/articles",templateUrl:"article.template.html",controller:"ArticleController"}).state("login",{url:"/login",templateUrl:"login.template.html",controller:"LoginController"}).state("battery",{url:"/battery",templateUrl:"battery.template.html",controller:"BatteryController"}),t.otherwise("/")}]).factory("RSSLoader",["$http",function(e){var t="http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=50&callback=JSON_CALLBACK&q=",o="http://vcunews.com/";return{getByCategoryNextPage:function(r,n){return e.jsonp(t+encodeURIComponent(o+r+"?paged="+n))},resetPage:function(){categoryPage={}}}}]).factory("ArticleHolder",function(){var e={feed:null};return e}).service("LoginService",["$q",function(e){return{loginUser:function(t,o){var r=e.defer(),n=r.promise;return"admin"==t&&"1234"==o?r.resolve("Welcome "+t+"!"):r.reject("Wrong credentials."),n.success=function(e){return n.then(e),n},n.error=function(e){return n.then(null,e),n},n}}}]).controller("ArticleController",["$scope","RSSLoader","$http","$state","ArticleHolder",function(e,t,o,r,n){e.feed=n.feed,e.backHome=function(){r.go("home")},e.share=function(){r.go("share")}}]).controller("BatteryController",["$scope","$rootScope","$ionicPlatform","$cordovaBatteryStatus",function(e,t,o,r){e.isPlugged=!1,e.batteryLevel=0,o.ready(function(){t.$on("$cordovaBatteryStatus:status",function(t,o){e.isPlugged=o.isPlugged,e.batteryLevel=o.level,o.isPlugged?alert("Charging -> "+o.level+"%"):alert("Battery -> "+o.level+"%")})})}]).controller("HomeController",["$scope","RSSLoader","$http","$state","ArticleHolder","$ionicSideMenuDelegate",function(e,t,o,r,n,l){function a(t){var o=t.responseData;if(null!=o){var r=o.feed.entries.map(function(e){return e.publishedDate=moment(e.publishedDate),e.imageSrc=null!=$("img",e.content)[0]?$("img",e.content)[0].src:"",e});e.feeds=e.feeds.concat(r)}else e.moreDataCanBeLoaded=!1}var c="feed";e.feeds=[],e.moreDataCanBeLoaded=!0;var i=1;e.loadMore=function(){t.getByCategoryNextPage(c,i).success(function(t){a(t),i+=1,e.$broadcast("scroll.infiniteScrollComplete")})},e.viewArticle=function(e){n.feed=e,r.go("articles")},e.toggleLeftMenu=function(){l.toggleLeft()},e.login=function(){r.go("login")},e.battery=function(){r.go("battery")}}]).controller("LoginController",["$scope","LoginService","$ionicPopup","$state",function(e,t,o,r){e.data={},e.login=function(){t.loginUser(e.data.username,e.data.password).success(function(e){o.alert({title:"Login success!",template:"Redirect to homepage..."});r.go("home")}).error(function(e){o.alert({title:"Login failed!",template:"Please check your credentials!"})})}}]);